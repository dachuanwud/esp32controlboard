# ðŸ” æ•…éšœæŽ’é™¤æ–‡æ¡£

æœ¬ç›®å½•åŒ…å«ESP32æŽ§åˆ¶æ¿é¡¹ç›®å¼€å‘å’Œä½¿ç”¨è¿‡ç¨‹ä¸­çš„æ•…éšœæŽ’é™¤æŒ‡å—ï¼Œæ¶µç›–å¸¸è§é—®é¢˜ã€è°ƒè¯•æ–¹æ³•ã€æµ‹è¯•å·¥å…·å’Œè§£å†³æ–¹æ¡ˆã€‚

## ðŸ“‹ æ–‡æ¡£åˆ—è¡¨

### ðŸ”Œ ç¡¬ä»¶æµ‹è¯•
- **usb-ttl-testing-guide.md** - USBè½¬TTLæµ‹è¯•è¯´æ˜Ž
  - ç¡¬ä»¶è¿žæŽ¥å’Œé…ç½®
  - é€šä¿¡æµ‹è¯•æ–¹æ³•
  - å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
  - æµ‹è¯•å·¥å…·ä½¿ç”¨æŒ‡å—

## ðŸŽ¯ æ•…éšœåˆ†ç±»

### ç¡¬ä»¶ç›¸å…³é—®é¢˜
- **è¿žæŽ¥é—®é¢˜**: çº¿ç¼†ã€æŽ¥æ’ä»¶ã€ç„ŠæŽ¥
- **ç”µæºé—®é¢˜**: ä¾›ç”µä¸è¶³ã€ç”µåŽ‹å¼‚å¸¸
- **ä¿¡å·é—®é¢˜**: ä¿¡å·å®Œæ•´æ€§ã€å¹²æ‰°
- **å™¨ä»¶é—®é¢˜**: èŠ¯ç‰‡æŸåã€å¤–è®¾æ•…éšœ

### è½¯ä»¶ç›¸å…³é—®é¢˜
- **ç¼–è¯‘é—®é¢˜**: çŽ¯å¢ƒé…ç½®ã€ä¾èµ–ç¼ºå¤±
- **çƒ§å½•é—®é¢˜**: ç«¯å£é€‰æ‹©ã€é©±åŠ¨å®‰è£…
- **è¿è¡Œé—®é¢˜**: ç¨‹åºå¼‚å¸¸ã€æ­»æœºé‡å¯
- **é€šä¿¡é—®é¢˜**: åè®®é”™è¯¯ã€æ•°æ®ä¸¢å¤±

### ç³»ç»Ÿé›†æˆé—®é¢˜
- **æ—¶åºé—®é¢˜**: ä»»åŠ¡è°ƒåº¦ã€ä¸­æ–­å†²çª
- **èµ„æºé—®é¢˜**: å†…å­˜ä¸è¶³ã€æ ˆæº¢å‡º
- **æ€§èƒ½é—®é¢˜**: CPUå ç”¨ã€å“åº”å»¶è¿Ÿ
- **å…¼å®¹é—®é¢˜**: ç‰ˆæœ¬ä¸åŒ¹é…ã€é…ç½®å†²çª

## ðŸ”§ å¸¸è§é—®é¢˜å¿«é€Ÿç´¢å¼•

### ç¼–è¯‘å’Œçƒ§å½•é—®é¢˜

#### é—®é¢˜1: ç¼–è¯‘å¤±è´¥
**ç—‡çŠ¶**: ç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºçŽ°é”™è¯¯
**å¯èƒ½åŽŸå› **:
- ESP-IDFçŽ¯å¢ƒæœªæ­£ç¡®é…ç½®
- ä¾èµ–åº“ç¼ºå¤±æˆ–ç‰ˆæœ¬ä¸åŒ¹é…
- ä»£ç è¯­æ³•é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ESP-IDFçŽ¯å¢ƒ
idf.py --version

# æ¸…ç†é‡æ–°ç¼–è¯‘
idf.py clean
idf.py build

# æ£€æŸ¥é…ç½®
idf.py menuconfig
```

#### é—®é¢˜2: çƒ§å½•å¤±è´¥
**ç—‡çŠ¶**: æ— æ³•è¿žæŽ¥åˆ°ESP32æˆ–çƒ§å½•ä¸­æ–­
**å¯èƒ½åŽŸå› **:
- USBé©±åŠ¨æœªå®‰è£…
- ç«¯å£é€‰æ‹©é”™è¯¯
- ESP32æœªè¿›å…¥ä¸‹è½½æ¨¡å¼

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç«¯å£
idf.py -p COM10 monitor

# æ‰‹åŠ¨è¿›å…¥ä¸‹è½½æ¨¡å¼
# æŒ‰ä½BOOTé”®ï¼ŒæŒ‰ä¸‹RESETé”®ï¼Œæ¾å¼€RESETé”®ï¼Œæ¾å¼€BOOTé”®

# ä½¿ç”¨æ­£ç¡®ç«¯å£çƒ§å½•
idf.py -p COM10 flash
```

### è¿è¡Œæ—¶é—®é¢˜

#### é—®é¢˜3: ç¨‹åºæ— è¾“å‡º
**ç—‡çŠ¶**: çƒ§å½•æˆåŠŸä½†ä¸²å£æ— è¾“å‡º
**å¯èƒ½åŽŸå› **:
- ä¸²å£é…ç½®é”™è¯¯
- ç¨‹åºå¡æ­»æˆ–å¼‚å¸¸
- ç¡¬ä»¶è¿žæŽ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ä¸²å£ç›‘æŽ§
idf.py -p COM10 monitor

# æ£€æŸ¥æ³¢ç‰¹çŽ‡è®¾ç½®
# ç¡®è®¤ä¸º115200

# é‡å¯ESP32
# æŒ‰ä¸‹RESETé”®
```

#### é—®é¢˜4: SBUSæ— æ•°æ®
**ç—‡çŠ¶**: SBUSæŽ¥æ”¶ä¸åˆ°é¥æŽ§å™¨æ•°æ®
**å¯èƒ½åŽŸå› **:
- é¥æŽ§å™¨æœªå¼€å¯æˆ–æœªç»‘å®š
- SBUSçº¿ç¼†è¿žæŽ¥é”™è¯¯
- UARTé…ç½®å‚æ•°é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥é¥æŽ§å™¨çŠ¶æ€å’Œç»‘å®š
2. ç¡®è®¤SBUSçº¿ç¼†è¿žæŽ¥åˆ°GPIO22
3. éªŒè¯UARTé…ç½® (100000, 8E2, åç›¸)
4. ä½¿ç”¨ç¤ºæ³¢å™¨æ£€æŸ¥SBUSä¿¡å·

#### é—®é¢˜5: CANé€šä¿¡å¤±è´¥
**ç—‡çŠ¶**: æ— æ³•å‘é€CANæ¶ˆæ¯æˆ–ç”µæœºæ— å“åº”
**å¯èƒ½åŽŸå› **:
- CANæ”¶å‘å™¨æœªè¿žæŽ¥
- æ€»çº¿ç»ˆç«¯ç”µé˜»ç¼ºå¤±
- æ³¢ç‰¹çŽ‡ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥CANæ”¶å‘å™¨è¿žæŽ¥ (GPIO16/17)
2. ç¡®è®¤120Î©ç»ˆç«¯ç”µé˜»
3. éªŒè¯æ³¢ç‰¹çŽ‡è®¾ç½® (250kbps)
4. ä½¿ç”¨CANåˆ†æžä»ªæ£€æŸ¥æ€»çº¿çŠ¶æ€

## ðŸ› ï¸ è°ƒè¯•å·¥å…·å’Œæ–¹æ³•

### ç¡¬ä»¶è°ƒè¯•å·¥å…·
- **ä¸‡ç”¨è¡¨**: ç”µåŽ‹ã€ç”µæµã€ç”µé˜»æµ‹é‡
- **ç¤ºæ³¢å™¨**: ä¿¡å·æ³¢å½¢åˆ†æž
- **é€»è¾‘åˆ†æžä»ª**: æ•°å­—ä¿¡å·æ—¶åºåˆ†æž
- **CANåˆ†æžä»ª**: CANæ€»çº¿åè®®åˆ†æž

### è½¯ä»¶è°ƒè¯•å·¥å…·
- **ESP-IDF Monitor**: ä¸²å£æ—¥å¿—ç›‘æŽ§
- **GDBè°ƒè¯•å™¨**: ç¨‹åºæ–­ç‚¹è°ƒè¯•
- **Heap Trace**: å†…å­˜æ³„æ¼æ£€æµ‹
- **Task Monitor**: ä»»åŠ¡çŠ¶æ€ç›‘æŽ§

### è°ƒè¯•æŠ€å·§

#### 1. æ—¥å¿—è°ƒè¯•
```c
// ä½¿ç”¨åˆ†çº§æ—¥å¿—
ESP_LOGE(TAG, "Critical error: %d", error_code);
ESP_LOGW(TAG, "Warning: %s", warning_msg);
ESP_LOGI(TAG, "Info: %d", info_value);
ESP_LOGD(TAG, "Debug: %x", debug_data);

// è®¾ç½®æ—¥å¿—çº§åˆ«
esp_log_level_set("*", ESP_LOG_INFO);
esp_log_level_set("SBUS", ESP_LOG_DEBUG);
```

#### 2. æ–­è¨€æ£€æŸ¥
```c
// å‚æ•°æ£€æŸ¥
assert(ptr != NULL);
assert(value >= 0 && value <= 100);

// ESP-IDFæ–­è¨€
ESP_ERROR_CHECK(esp_err);
```

#### 3. çŠ¶æ€ç›‘æŽ§
```c
// ä»»åŠ¡çŠ¶æ€ç›‘æŽ§
void monitor_task(void *pvParameters) {
    while (1) {
        // è¾“å‡ºç³»ç»ŸçŠ¶æ€
        ESP_LOGI(TAG, "Free heap: %d", esp_get_free_heap_size());
        ESP_LOGI(TAG, "Min free heap: %d", esp_get_minimum_free_heap_size());
        
        vTaskDelay(pdMS_TO_TICKS(5000));
    }
}
```

## ðŸ“Š æ€§èƒ½ç›‘æŽ§

### ç³»ç»Ÿèµ„æºç›‘æŽ§
```c
// CPUä½¿ç”¨çŽ‡ç›‘æŽ§
void print_task_stats(void) {
    char *task_list_buffer = malloc(2048);
    vTaskList(task_list_buffer);
    ESP_LOGI(TAG, "Task List:\n%s", task_list_buffer);
    free(task_list_buffer);
}

// å†…å­˜ä½¿ç”¨ç›‘æŽ§
void print_memory_stats(void) {
    ESP_LOGI(TAG, "Free heap: %d bytes", esp_get_free_heap_size());
    ESP_LOGI(TAG, "Largest free block: %d bytes", heap_caps_get_largest_free_block(MALLOC_CAP_8BIT));
}
```

### é€šä¿¡è´¨é‡ç›‘æŽ§
```c
// SBUSæ•°æ®è´¨é‡
static uint32_t sbus_frame_count = 0;
static uint32_t sbus_error_count = 0;

void sbus_quality_check(void) {
    float success_rate = (float)(sbus_frame_count - sbus_error_count) / sbus_frame_count * 100;
    ESP_LOGI(TAG, "SBUS success rate: %.2f%%", success_rate);
}
```

## ðŸš¨ ç´§æ€¥æ•…éšœå¤„ç†

### ç³»ç»Ÿæ­»æœº
1. **ç«‹å³æ“ä½œ**: æ–­ç”µé‡å¯
2. **æ£€æŸ¥æ—¥å¿—**: æŸ¥çœ‹æœ€åŽçš„é”™è¯¯ä¿¡æ¯
3. **åˆ†æžåŽŸå› **: æ ˆæº¢å‡ºã€å†…å­˜æ³„æ¼ã€æ­»é”
4. **ä¸´æ—¶æ–¹æ¡ˆ**: å¢žåŠ çœ‹é—¨ç‹—ä¿æŠ¤

### é€šä¿¡ä¸­æ–­
1. **æ£€æŸ¥è¿žæŽ¥**: éªŒè¯ç¡¬ä»¶è¿žæŽ¥
2. **é‡ç½®æ¨¡å—**: é‡æ–°åˆå§‹åŒ–é€šä¿¡æ¨¡å—
3. **é™çº§è¿è¡Œ**: åˆ‡æ¢åˆ°å®‰å…¨æ¨¡å¼
4. **æŠ¥è­¦æç¤º**: é€šçŸ¥ç”¨æˆ·æ•…éšœçŠ¶æ€

### æ•°æ®å¼‚å¸¸
1. **æ•°æ®æ ¡éªŒ**: æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
2. **é‡æ–°èŽ·å–**: é‡æ–°è¯»å–æ•°æ®æº
3. **é»˜è®¤å€¼**: ä½¿ç”¨å®‰å…¨é»˜è®¤å€¼
4. **é”™è¯¯è®°å½•**: è®°å½•å¼‚å¸¸äº‹ä»¶

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

### èŽ·å–å¸®åŠ©
- **æ–‡æ¡£æŸ¥é˜…**: ä¼˜å…ˆæŸ¥é˜…ç›¸å…³æŠ€æœ¯æ–‡æ¡£
- **ç¤¾åŒºæ”¯æŒ**: ESP32å¼€å‘è€…ç¤¾åŒºå’Œè®ºå›
- **å®˜æ–¹æ”¯æŒ**: Espressifå®˜æ–¹æŠ€æœ¯æ”¯æŒ
- **å¼€æºé¡¹ç›®**: GitHubç›¸å…³å¼€æºé¡¹ç›®

### é—®é¢˜æŠ¥å‘Š
æäº¤é—®é¢˜æ—¶è¯·åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
1. **ç¡¬ä»¶ç‰ˆæœ¬**: ESP32åž‹å·å’Œå¼€å‘æ¿ä¿¡æ¯
2. **è½¯ä»¶ç‰ˆæœ¬**: ESP-IDFç‰ˆæœ¬å’Œé¡¹ç›®ç‰ˆæœ¬
3. **é—®é¢˜æè¿°**: è¯¦ç»†çš„é—®é¢˜çŽ°è±¡å’Œå¤çŽ°æ­¥éª¤
4. **é”™è¯¯æ—¥å¿—**: å®Œæ•´çš„é”™è¯¯æ—¥å¿—å’Œè°ƒè¯•ä¿¡æ¯
5. **çŽ¯å¢ƒä¿¡æ¯**: å¼€å‘çŽ¯å¢ƒå’Œå·¥å…·é“¾ç‰ˆæœ¬

---

ðŸ’¡ **æç¤º**: é‡åˆ°é—®é¢˜æ—¶ï¼Œè¯·å…ˆæŸ¥é˜…ç›¸å…³æ–‡æ¡£ï¼Œç„¶åŽå°è¯•åŸºæœ¬çš„æŽ’æŸ¥æ­¥éª¤ï¼
